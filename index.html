<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NVD Learning – Image Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body style="font-family: Arial, sans-serif; padding: 40px; background:#fafafa;">

  <h2>NVD Learning – Image Upload</h2>
  <p style="max-width:600px;">
    Upload one image per question.  
    After uploading, copy the image URL and paste it into the
    <b>image_url</b> column of your CSV.
  </p>

  <!-- Upload button -->
  <button
    id="uploadBtn"
    style="padding:12px 18px; font-size:16px; cursor:pointer;"
  >
    Upload Image(s)
  </button>

  <!-- Search bar -->
  <div style="margin-top:20px;">
    <input
      type="text"
      id="searchInput"
      placeholder="Search images by filename (e.g. 45, Q45, logic)"
      style="padding:10px; width:100%; max-width:420px; font-size:14px;"
    />
  </div>

  <!-- Grid -->
  <div
    id="grid"
    style="
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
      gap:16px;
      margin-top:25px;
    "
  ></div>

  <!-- Cloudinary widget -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

  <script>
    // ===== CONFIG =====
    const CLOUD_NAME = "dpdbtl8on";              // <-- CHANGE THIS
    const UPLOAD_PRESET = "catalyst-group-latur";        // <-- CHANGE THIS

    // ===== STATE =====
    const grid = document.getElementById("grid");
    const searchInput = document.getElementById("searchInput");
    const uploadedFilenames = {};

    // ===== UPLOAD WIDGET =====
    const widget = cloudinary.createUploadWidget(
      {
        cloudName: CLOUD_NAME,
        uploadPreset: UPLOAD_PRESET,
        multiple: true
      },
      (error, result) => {
        if (!error && result && result.event === "success") {
          addImageCard(result.info);
        }
      }
    );

    document.getElementById("uploadBtn").onclick = () => widget.open();

    // ===== ADD IMAGE CARD =====
    function addImageCard(info) {
      const filenameLower = info.original_filename.toLowerCase();
      uploadedFilenames[filenameLower] =
        (uploadedFilenames[filenameLower] || 0) + 1;

      const card = document.createElement("div");
      card.style.border = "1px solid #ddd";
      card.style.padding = "10px";
      card.style.borderRadius = "8px";
      card.style.background = "#fff";
      card.style.textAlign = "center";
      card.dataset.filename = filenameLower;

      // Thumbnail
      const img = document.createElement("img");
      img.src = info.thumbnail_url;
      img.style.width = "100%";
      img.style.height = "120px";
      img.style.objectFit = "contain";

      // Filename
      const name = document.createElement("div");
      name.innerText = info.original_filename;
      name.style.marginTop = "6px";
      name.style.fontSize = "13px";
      name.style.fontWeight = "600";
      name.style.wordBreak = "break-all";

      // Duplicate warning (non-blocking)
      let warning = null;
      if (uploadedFilenames[filenameLower] > 1) {
        warning = document.createElement("div");
        warning.innerText = "⚠ Duplicate filename";
        warning.style.color = "#b45309";
        warning.style.fontSize = "12px";
        warning.style.marginTop = "4px";
      }

      // Copy URL button
      const btn = document.createElement("button");
      btn.innerText = "Copy URL";
      btn.style.marginTop = "8px";
      btn.style.padding = "6px 10px";
      btn.style.cursor = "pointer";

      btn.onclick = () => {
        navigator.clipboard.writeText(info.secure_url);
        btn.innerText = "Copied ✓";
        btn.style.backgroundColor = "#16a34a";
        btn.style.color = "#fff";
        btn.disabled = true;
      };

      // Assemble card
      card.appendChild(img);
      card.appendChild(name);
      if (warning) card.appendChild(warning);
      card.appendChild(btn);
      grid.appendChild(card);
    }

    // ===== SEARCH / FILTER =====
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      const cards = document.querySelectorAll("#grid > div");

      cards.forEach(card => {
        const filename = card.dataset.filename || "";
        card.style.display = filename.includes(query) ? "" : "none";
      });
    });
  </script>

</body>
</html>
